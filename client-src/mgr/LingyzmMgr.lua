-- LingyzmMgr.lua
-- Created by haungzz July/21/2018
-- 灵音镇魔活动管理器

LingyzmMgr = Singleton()

LingyzmMgr.yaomoChars = {}

local POS_CONFIG = {
    [CHS[3000860]] = { -- 桃柳林
        {x = 54, y = 49},
        {x = 54, y = 48},
        {x = 53, y = 48},
        {x = 53, y = 47},
        {x = 53, y = 46},
        {x = 53, y = 45},
        {x = 53, y = 44},
        {x = 52, y = 43},
        {x = 52, y = 42},
        {x = 52, y = 41},
        {x = 52, y = 40},
        {x = 52, y = 39},
        {x = 51, y = 39},
        {x = 51, y = 38},
        {x = 51, y = 37},
        {x = 51, y = 36},
        {x = 51, y = 35},
        {x = 50, y = 35},
        {x = 50, y = 34},
        {x = 50, y = 33},
        {x = 49, y = 33, isTurn = true},
        {x = 49, y = 32},
        {x = 48, y = 32},
        {x = 47, y = 32},
        {x = 46, y = 32},
        {x = 46, y = 31},
        {x = 45, y = 31},
        {x = 44, y = 31},
        {x = 44, y = 30},
        {x = 43, y = 30},
        {x = 42, y = 30},
        {x = 41, y = 30},
        {x = 41, y = 29},
        {x = 40, y = 29},
        {x = 39, y = 29},
        {x = 39, y = 28},
        {x = 38, y = 28},
        {x = 37, y = 28},
        {x = 37, y = 27},
        {x = 36, y = 27},
        {x = 35, y = 27},
        {x = 34, y = 27},
        {x = 34, y = 26},
        {x = 33, y = 26},
        {x = 32, y = 26},
        {x = 32, y = 25},
        {x = 31, y = 25},
        {x = 30, y = 25},
        {x = 29, y = 25},
        {x = 29, y = 24},
        {x = 28, y = 24},
        {x = 27, y = 24},
        {x = 27, y = 23},
        {x = 26, y = 23},
        {x = 25, y = 23},
        {x = 24, y = 23},
        {x = 24, y = 22},
        {x = 23, y = 22},
        {x = 22, y = 22},
        {x = 22, y = 21},
        {x = 21, y = 21},
        {x = 20, y = 21},
        {x = 19, y = 20},
        {x = 18, y = 20},
        {x = 17, y = 20},
        {x = 17, y = 19},
        {x = 16, y = 19},
        {x = 15, y = 19},
        {x = 14, y = 18},
        {x = 13, y = 18},
        {x = 12, y = 18},
        {x = 12, y = 17},
        {x = 11, y = 17, isTurn = true},
        {x = 11, y = 16},
        {x = 11, y = 15},
        {x = 10, y = 15},
        {x = 10, y = 14},
        {x = 10, y = 13},
        {x = 10, y = 12},
        {x = 9,  y = 11},
        {x = 9,  y = 10},
        {x = 9,  y = 9 },
        {x = 9,  y = 8 },
        {x = 8,  y = 8 },
        {x = 8,  y = 7 },
        {x = 8,  y = 6 },
        {x = 8,  y = 5 },
        {x = 7,  y = 5 },
        {x = 7,  y = 4 },
        {x = 7,  y = 3 },
    },

    [CHS[3001303]] = { -- 卧龙坡
        {x = 8,  y = 41},
        {x = 9,  y = 41},
        {x = 9,  y = 40},
        {x = 10, y = 40},
        {x = 10, y = 39},
        {x = 11, y = 38},
        {x = 11, y = 37},
        {x = 12, y = 37},
        {x = 12, y = 36},
        {x = 13, y = 36},
        {x = 13, y = 35},
        {x = 14, y = 34},
        {x = 14, y = 33},
        {x = 15, y = 33},
        {x = 15, y = 32},
        {x = 16, y = 32},
        {x = 16, y = 31},
        {x = 17, y = 31},
        {x = 17, y = 30},
        {x = 18, y = 30, isTurn = true},
        {x = 18, y = 31},
        {x = 19, y = 31},
        {x = 20, y = 31},
        {x = 21, y = 31},
        {x = 21, y = 32},
        {x = 22, y = 32},
        {x = 23, y = 32},
        {x = 24, y = 33},
        {x = 25, y = 33},
        {x = 26, y = 33},
        {x = 27, y = 34},
        {x = 28, y = 34},
        {x = 29, y = 34},
        {x = 29, y = 35},
        {x = 30, y = 35},
        {x = 31, y = 35},
        {x = 32, y = 35},
        {x = 32, y = 36},
        {x = 33, y = 36},
        {x = 34, y = 36},
        {x = 35, y = 36},
        {x = 35, y = 37},
        {x = 36, y = 37},
        {x = 37, y = 37},
        {x = 38, y = 37},
        {x = 38, y = 38},
        {x = 39, y = 38},
        {x = 40, y = 38},
        {x = 41, y = 39},
        {x = 42, y = 39},
        {x = 43, y = 39},
        {x = 44, y = 40},
        {x = 45, y = 40, isTurn = true},
        {x = 45, y = 39},
        {x = 45, y = 38},
        {x = 44, y = 38},
        {x = 44, y = 37},
        {x = 44, y = 36},
        {x = 44, y = 35},
        {x = 43, y = 35},
        {x = 43, y = 34},
        {x = 43, y = 33},
        {x = 43, y = 32},
        {x = 43, y = 31},
        {x = 42, y = 31},
        {x = 42, y = 30},
        {x = 42, y = 29},
        {x = 42, y = 28},
        {x = 41, y = 27},
        {x = 41, y = 26},
        {x = 41, y = 25},
        {x = 41, y = 24},
        {x = 40, y = 24},
        {x = 40, y = 23},
        {x = 40, y = 22},
        {x = 40, y = 21},
        {x = 40, y = 20},
        {x = 39, y = 20},
        {x = 39, y = 19},
        {x = 39, y = 18},
        {x = 39, y = 17},
        {x = 38, y = 17},
        {x = 38, y = 16},
        {x = 38, y = 15, isTurn = true},
        {x = 39, y = 15},
        {x = 39, y = 14},
        {x = 40, y = 14},
        {x = 41, y = 13},
        {x = 42, y = 13},
        {x = 42, y = 12},
        {x = 43, y = 12},
        {x = 44, y = 11},
        {x = 45, y = 11},
        {x = 45, y = 10},
        {x = 46, y = 10},
    },

    [CHS[3001382]] = { -- 揽仙镇外
        {x = 9 , y = 43},
        {x = 10, y = 43},
        {x = 11, y = 43},
        {x = 12, y = 43},
        {x = 13, y = 43},
        {x = 14, y = 43},
        {x = 15, y = 43},
        {x = 16, y = 43},
        {x = 17, y = 43},
        {x = 18, y = 43},
        {x = 19, y = 43},
        {x = 20, y = 43},
        {x = 21, y = 43},
        {x = 22, y = 43},
        {x = 23, y = 43},
        {x = 24, y = 43},
        {x = 25, y = 43},
        {x = 26, y = 43},
        {x = 27, y = 43},
        {x = 28, y = 43},
        {x = 29, y = 43},
        {x = 30, y = 43},
        {x = 31, y = 43},
        {x = 32, y = 43},
        {x = 33, y = 43, isTurn = true},
        {x = 34, y = 42},
        {x = 35, y = 42},
        {x = 35, y = 41},
        {x = 36, y = 41},
        {x = 36, y = 40},
        {x = 37, y = 40},
        {x = 38, y = 40},
        {x = 38, y = 39},
        {x = 39, y = 39},
        {x = 39, y = 38},
        {x = 40, y = 38},
        {x = 41, y = 38},
        {x = 41, y = 37},
        {x = 42, y = 37},
        {x = 42, y = 36},
        {x = 43, y = 36},
        {x = 43, y = 35},
        {x = 44, y = 35, isTurn = true},
        {x = 43, y = 34},
        {x = 42, y = 34},
        {x = 42, y = 33},
        {x = 41, y = 33},
        {x = 41, y = 32},
        {x = 40, y = 32},
        {x = 40, y = 31},
        {x = 39, y = 31},
        {x = 39, y = 30},
        {x = 38, y = 30},
        {x = 37, y = 30},
        {x = 37, y = 29},
        {x = 36, y = 29},
        {x = 36, y = 28},
        {x = 35, y = 28},
        {x = 35, y = 27},
        {x = 34, y = 27},
        {x = 34, y = 26},
        {x = 33, y = 26},
        {x = 33, y = 25},
        {x = 32, y = 25},
        {x = 32, y = 24},
        {x = 31, y = 24},
        {x = 31, y = 23},
        {x = 30, y = 23},
        {x = 30, y = 22},
        {x = 30, y = 21},
        {x = 29, y = 21},
        {x = 29, y = 20},
        {x = 28, y = 20},
        {x = 28, y = 19, isTurn = true},
        {x = 29, y = 18},
        {x = 30, y = 18},
        {x = 30, y = 17},
        {x = 31, y = 17},
        {x = 31, y = 16},
        {x = 32, y = 16},
        {x = 32, y = 15},
        {x = 33, y = 15},
        {x = 34, y = 14},
        {x = 35, y = 14},
        {x = 35, y = 13},
        {x = 36, y = 13},
        {x = 36, y = 12},
        {x = 37, y = 12},
        {x = 37, y = 11},
        {x = 38, y = 11},
        {x = 39, y = 10},
        {x = 40, y = 10},
        {x = 40, y =  9},
        {x = 41, y =  9},
        {x = 41, y =  8},
        {x = 42, y =  8},
        {x = 42, y =  7},
        {x = 43, y =  7},
        {x = 44, y =  6},
        {x = 45, y =  6},
        {x = 45, y =  5},
        {x = 46, y =  5},
        {x = 46, y =  4},
        {x = 47, y =  4},
        {x = 47, y =  3},
        {x = 48, y =  3},
    },

    [CHS[4100246]] = { -- 绝仙阵
        {x = 7 , y = 48},
        {x = 8 , y = 48},
        {x = 9 , y = 48},
        {x = 10, y = 48},
        {x = 11, y = 48},
        {x = 12, y = 48},
        {x = 13, y = 48},
        {x = 14, y = 48},
        {x = 15, y = 48},
        {x = 16, y = 48},
        {x = 17, y = 48},
        {x = 18, y = 48},
        {x = 19, y = 48},
        {x = 20, y = 48},
        {x = 21, y = 48},
        {x = 22, y = 48},
        {x = 23, y = 48},
        {x = 24, y = 48},
        {x = 25, y = 48},
        {x = 26, y = 48},
        {x = 27, y = 48},
        {x = 28, y = 48},
        {x = 29, y = 48},
        {x = 30, y = 48},
        {x = 31, y = 48},
        {x = 32, y = 48},
        {x = 33, y = 48},
        {x = 34, y = 48},
        {x = 35, y = 48},
        {x = 36, y = 48},
        {x = 37, y = 48},
        {x = 38, y = 48},
        {x = 39, y = 48},
        {x = 40, y = 48},
        {x = 41, y = 48},
        {x = 42, y = 48},
        {x = 43, y = 48},
        {x = 44, y = 48},
        {x = 45, y = 48},
        {x = 46, y = 48},
        {x = 47, y = 48},
        {x = 48, y = 48},
        {x = 47, y = 48, isTurn = true},
        {x = 47, y = 47},
        {x = 47, y = 46},
        {x = 46, y = 46},
        {x = 46, y = 45},
        {x = 46, y = 44},
        {x = 45, y = 44},
        {x = 45, y = 43},
        {x = 45, y = 42},
        {x = 44, y = 42},
        {x = 44, y = 41},
        {x = 43, y = 40},
        {x = 43, y = 39},
        {x = 42, y = 39},
        {x = 42, y = 38},
        {x = 42, y = 37},
        {x = 41, y = 37},
        {x = 41, y = 36, isTurn = true},
        {x = 40, y = 35},
        {x = 39, y = 35},
        {x = 39, y = 34},
        {x = 38, y = 34},
        {x = 37, y = 33},
        {x = 36, y = 33},
        {x = 36, y = 32},
        {x = 35, y = 32},
        {x = 35, y = 31},
        {x = 34, y = 31},
        {x = 33, y = 31},
        {x = 33, y = 30},
        {x = 32, y = 30},
        {x = 32, y = 29},
        {x = 31, y = 29},
        {x = 30, y = 28},
        {x = 29, y = 28},
        {x = 29, y = 27},
        {x = 28, y = 27},
        {x = 27, y = 26},
        {x = 26, y = 26},
        {x = 26, y = 25},
        {x = 25, y = 25},
        {x = 25, y = 24},
        {x = 24, y = 24},
        {x = 23, y = 24},
        {x = 23, y = 23},
        {x = 22, y = 23},
        {x = 22, y = 22},
        {x = 21, y = 22},
        {x = 21, y = 21},
        {x = 20, y = 21},
        {x = 19, y = 21},
        {x = 19, y = 20},
        {x = 18, y = 20},
        {x = 18, y = 19},
        {x = 17, y = 19},
        {x = 17, y = 18},
        {x = 16, y = 18, isTurn = true},
        {x = 17, y = 18},
        {x = 18, y = 17},
        {x = 19, y = 17},
        {x = 20, y = 17},
        {x = 21, y = 16},
        {x = 22, y = 16},
        {x = 23, y = 16},
        {x = 24, y = 15},
        {x = 25, y = 15},
        {x = 26, y = 15},
        {x = 27, y = 14},
        {x = 28, y = 14},
        {x = 29, y = 14, isTurn = true},
        {x = 30, y = 13},
        {x = 31, y = 13},
        {x = 31, y = 12},
        {x = 32, y = 12},
        {x = 33, y = 11},
        {x = 33, y = 10},
        {x = 34, y = 10},
        {x = 34, y =  9},
        {x = 35, y =  9},
        {x = 35, y =  8},
        {x = 36, y =  8},
        {x = 36, y =  7},
        {x = 37, y =  7},
        {x = 37, y =  6},
        {x = 38, y =  6},
        {x = 39, y =  5},
    },

    [CHS[4100247]] = { -- 地绝阵
        {x = 8 , y = 9},
        {x = 8 , y = 10},
        {x = 8 , y = 11},
        {x = 8 , y = 12},
        {x = 7 , y = 13},
        {x = 7 , y = 14},
        {x = 7 , y = 15},
        {x = 7 , y = 16},
        {x = 7 , y = 17},
        {x = 7 , y = 18},
        {x = 7 , y = 19},
        {x = 7 , y = 20},
        {x = 7 , y = 21},
        {x = 6 , y = 22},
        {x = 6 , y = 23},
        {x = 6 , y = 24},
        {x = 6 , y = 25},
        {x = 6 , y = 26},
        {x = 6 , y = 27},
        {x = 6 , y = 28},
        {x = 6 , y = 29},
        {x = 6 , y = 30},
        {x = 6 , y = 31},
        {x = 6 , y = 32},
        {x = 6 , y = 33},
        {x = 6 , y = 34},
        {x = 6 , y = 35},
        {x = 6 , y = 36},
        {x = 7 , y = 37},
        {x = 7 , y = 38},
        {x = 7 , y = 39},
        {x = 7 , y = 40},
        {x = 7 , y = 41},
        {x = 7 , y = 42},
        {x = 7 , y = 43},
        {x = 7 , y = 44},
        {x = 7 , y = 45},
        {x = 7 , y = 46, isTurn = true},
        {x = 7 , y = 47},
        {x = 8 , y = 47},
        {x = 9 , y = 47},
        {x = 10, y = 47},
        {x = 11, y = 47},
        {x = 12, y = 47},
        {x = 13, y = 47},
        {x = 14, y = 47},
        {x = 15, y = 47},
        {x = 16, y = 47},
        {x = 17, y = 47},
        {x = 18, y = 47},
        {x = 19, y = 47},
        {x = 20, y = 47},
        {x = 21, y = 47},
        {x = 22, y = 47},
        {x = 23, y = 47},
        {x = 24, y = 47},
        {x = 25, y = 47},
        {x = 26, y = 47},
        {x = 27, y = 47},
        {x = 28, y = 47},
        {x = 29, y = 47},
        {x = 30, y = 47},
        {x = 31, y = 47},
        {x = 32, y = 47},
        {x = 33, y = 47},
        {x = 34, y = 47},
        {x = 35, y = 47},
        {x = 36, y = 47},
        {x = 37, y = 47, isTurn = true},
        {x = 38, y = 46},
        {x = 39, y = 46},
        {x = 39, y = 45},
        {x = 40, y = 45},
        {x = 41, y = 44},
        {x = 42, y = 44},
        {x = 42, y = 43},
        {x = 43, y = 43},
        {x = 43, y = 42},
        {x = 44, y = 42},
        {x = 45, y = 42},
        {x = 45, y = 41},
        {x = 46, y = 41},
        {x = 46, y = 40},
        {x = 47, y = 40, isTurn = true},
        {x = 46, y = 39},
        {x = 45, y = 39},
        {x = 45, y = 38},
        {x = 44, y = 37},
        {x = 43, y = 37},
        {x = 43, y = 36},
        {x = 42, y = 36},
        {x = 42, y = 35},
        {x = 41, y = 35},
        {x = 41, y = 34},
        {x = 40, y = 34},
        {x = 40, y = 33},
        {x = 39, y = 33},
        {x = 39, y = 32},
        {x = 38, y = 32},
        {x = 38, y = 31},
        {x = 37, y = 31},
        {x = 37, y = 30},
        {x = 36, y = 30},
        {x = 36, y = 29},
        {x = 35, y = 29},
        {x = 35, y = 28},
        {x = 34, y = 28},
        {x = 34, y = 27},
        {x = 33, y = 27},
        {x = 33, y = 26},
        {x = 32, y = 26},
        {x = 31, y = 25},
        {x = 30, y = 24, isTurn = true},
        {x = 31, y = 23},
        {x = 32, y = 22},
        {x = 33, y = 21},
        {x = 33, y = 20},
        {x = 34, y = 20},
        {x = 34, y = 19},
        {x = 35, y = 19},
        {x = 35, y = 18},
        {x = 36, y = 18},
        {x = 36, y = 17},
        {x = 37, y = 17},
        {x = 37, y = 16},
        {x = 38, y = 16},
        {x = 38, y = 15},
        {x = 39, y = 15},
        {x = 39, y = 14},
        {x = 40, y = 14},
        {x = 40, y = 13},
        {x = 41, y = 13},
        {x = 41, y = 12},
        {x = 42, y = 12},
        {x = 42, y = 11},
        {x = 43, y = 11},
        {x = 43, y = 10},
        {x = 44, y = 10},
        {x = 44, y = 9 },
        {x = 45, y = 9 },
        {x = 45, y = 8 },
        {x = 46, y = 8 },
        {x = 46, y = 7 },
        {x = 47, y = 6 },
        {x = 48, y = 5 },
    },

    [CHS[4100248]] = { -- 天绝阵
        {x = 52, y = 5 },
        {x = 52, y = 6 },
        {x = 52, y = 7 },
        {x = 53, y = 8 },
        {x = 53, y = 9 },
        {x = 53, y = 10},
        {x = 53, y = 11},
        {x = 53, y = 12},
        {x = 53, y = 13},
        {x = 53, y = 14},
        {x = 54, y = 15},
        {x = 54, y = 16},
        {x = 54, y = 17},
        {x = 54, y = 18},
        {x = 54, y = 19},
        {x = 54, y = 20},
        {x = 54, y = 21},
        {x = 55, y = 22},
        {x = 55, y = 23},
        {x = 55, y = 24},
        {x = 55, y = 25},
        {x = 55, y = 26, isTurn = true},
        {x = 54, y = 26},
        {x = 54, y = 27},
        {x = 54, y = 28},
        {x = 53, y = 28},
        {x = 53, y = 29},
        {x = 53, y = 30},
        {x = 52, y = 31},
        {x = 52, y = 32},
        {x = 52, y = 33},
        {x = 51, y = 33},
        {x = 51, y = 34},
        {x = 51, y = 35},
        {x = 50, y = 35},
        {x = 50, y = 36},
        {x = 50, y = 37},
        {x = 49, y = 38},
        {x = 49, y = 39},
        {x = 49, y = 40},
        {x = 48, y = 40},
        {x = 48, y = 41},
        {x = 48, y = 42},
        {x = 47, y = 42},
        {x = 47, y = 43},
        {x = 47, y = 44},
        {x = 46, y = 45},
        {x = 46, y = 46},
        {x = 46, y = 47},
        {x = 45, y = 47},
        {x = 45, y = 48, isTurn = true},
        {x = 44, y = 48},
        {x = 43, y = 48},
        {x = 42, y = 48},
        {x = 41, y = 48},
        {x = 40, y = 48},
        {x = 39, y = 48},
        {x = 38, y = 48},
        {x = 37, y = 48},
        {x = 36, y = 48},
        {x = 35, y = 48},
        {x = 34, y = 48},
        {x = 33, y = 48},
        {x = 32, y = 48},
        {x = 31, y = 48},
        {x = 30, y = 48},
        {x = 29, y = 48},
        {x = 28, y = 48},
        {x = 27, y = 48},
        {x = 26, y = 48},
        {x = 25, y = 48},
        {x = 24, y = 48},
        {x = 23, y = 48},
        {x = 22, y = 48},
        {x = 21, y = 48},
        {x = 20, y = 48},
        {x = 19, y = 48},
        {x = 18, y = 48},
        {x = 17, y = 48},
        {x = 16, y = 48},
        {x = 15, y = 48},
        {x = 14, y = 48},
        {x = 13, y = 48},
        {x = 12, y = 48},
        {x = 11, y = 48},
        {x = 10, y = 48},
        {x = 9 , y = 48},
        {x = 8 , y = 48},
        {x = 7 , y = 48},
        {x = 6 , y = 48},
        {x = 5 , y = 48, isTurn = true},
        {x = 5 , y = 47},
        {x = 6 , y = 46},
        {x = 6 , y = 45},
        {x = 6 , y = 44},
        {x = 6 , y = 43},
        {x = 7 , y = 43},
        {x = 7 , y = 42},
        {x = 7 , y = 41},
        {x = 7 , y = 40},
        {x = 8 , y = 39},
        {x = 8 , y = 38},
        {x = 8 , y = 37},
        {x = 8 , y = 36},
        {x = 9 , y = 36},
        {x = 9 , y = 35},
        {x = 9 , y = 34, isTurn = true},
        {x = 10, y = 34},
        {x = 11, y = 34},
        {x = 12, y = 34},
        {x = 13, y = 34},
        {x = 14, y = 34},
        {x = 15, y = 34},
        {x = 16, y = 34},
        {x = 17, y = 34},
        {x = 18, y = 34},
        {x = 19, y = 34},
        {x = 20, y = 34},
        {x = 21, y = 34},
        {x = 22, y = 34},
        {x = 23, y = 34},
        {x = 24, y = 34, isTurn = true},
        {x = 24, y = 33},
        {x = 25, y = 33},
        {x = 25, y = 32},
        {x = 26, y = 32},
        {x = 26, y = 31},
        {x = 26, y = 30},
        {x = 27, y = 30},
        {x = 27, y = 29},
        {x = 28, y = 29},
        {x = 28, y = 28},
        {x = 28, y = 27},
        {x = 29, y = 27},
        {x = 29, y = 26},
        {x = 30, y = 26, isTurn = true},
        {x = 30, y = 25},
        {x = 30, y = 24},
        {x = 30, y = 23},
        {x = 30, y = 22},
        {x = 30, y = 21},
        {x = 30, y = 20},
        {x = 30, y = 19},
        {x = 30, y = 18},
        {x = 30, y = 17},
        {x = 30, y = 16},
        {x = 30, y = 15},
        {x = 30, y = 14},
        {x = 30, y = 13},
        {x = 30, y = 12},
        {x = 30, y = 11},
        {x = 30, y = 10},
        {x = 30, y = 9 },
        {x = 30, y = 8 },
        {x = 30, y = 7 },
        {x = 30, y = 6 },
    },

    [CHS[4100244]] = { -- 东昆仑
        {x = 22, y = 84},
        {x = 22, y = 83},
        {x = 23, y = 83},
        {x = 24, y = 83},
        {x = 24, y = 82},
        {x = 25, y = 82},
        {x = 26, y = 82},
        {x = 26, y = 81},
        {x = 27, y = 81},
        {x = 28, y = 81},
        {x = 29, y = 80},
        {x = 30, y = 80},
        {x = 31, y = 80},
        {x = 31, y = 79},
        {x = 32, y = 79},
        {x = 33, y = 79},
        {x = 33, y = 78},
        {x = 34, y = 78},
        {x = 35, y = 78},
        {x = 35, y = 77},
        {x = 36, y = 77},
        {x = 37, y = 77},
        {x = 37, y = 76},
        {x = 38, y = 76},
        {x = 38, y = 75},
        {x = 39, y = 75},
        {x = 39, y = 74},
        {x = 40, y = 74},
        {x = 40, y = 73},
        {x = 41, y = 73},
        {x = 41, y = 72},
        {x = 42, y = 72},
        {x = 42, y = 71},
        {x = 43, y = 71},
        {x = 43, y = 70},
        {x = 44, y = 70},
        {x = 44, y = 69},
        {x = 45, y = 69},
        {x = 45, y = 68},
        {x = 46, y = 68},
        {x = 46, y = 67},
        {x = 47, y = 67},
        {x = 47, y = 66},
        {x = 48, y = 65, isTurn = true},
        {x = 47, y = 65},
        {x = 47, y = 64},
        {x = 46, y = 64},
        {x = 45, y = 63},
        {x = 44, y = 63},
        {x = 44, y = 62},
        {x = 43, y = 62},
        {x = 42, y = 62},
        {x = 42, y = 61},
        {x = 41, y = 61},
        {x = 40, y = 60},
        {x = 39, y = 60},
        {x = 39, y = 59},
        {x = 38, y = 59},
        {x = 37, y = 59},
        {x = 37, y = 58},
        {x = 36, y = 58},
        {x = 35, y = 57},
        {x = 34, y = 57},
        {x = 34, y = 56},
        {x = 33, y = 56},
        {x = 32, y = 56},
        {x = 32, y = 55},
        {x = 31, y = 55},
        {x = 30, y = 54},
        {x = 29, y = 54},
        {x = 29, y = 53},
        {x = 28, y = 53},
        {x = 27, y = 53},
        {x = 27, y = 52},
        {x = 26, y = 52},
        {x = 26, y = 51},
        {x = 25, y = 51},
        {x = 25, y = 50},
        {x = 24, y = 50},
        {x = 23, y = 49},
        {x = 22, y = 48},
        {x = 21, y = 48},
        {x = 21, y = 47},
        {x = 20, y = 47},
        {x = 20, y = 46},
        {x = 19, y = 46},
        {x = 18, y = 45},
        {x = 17, y = 45},
        {x = 17, y = 44},
        {x = 16, y = 44},
        {x = 16, y = 43},
        {x = 15, y = 43},
        {x = 14, y = 42, isTurn = true},
        {x = 15, y = 42},
        {x = 15, y = 41},
        {x = 16, y = 41},
        {x = 16, y = 40},
        {x = 17, y = 40},
        {x = 18, y = 40},
        {x = 18, y = 39},
        {x = 19, y = 39},
        {x = 20, y = 38},
        {x = 21, y = 38},
        {x = 21, y = 37},
        {x = 22, y = 37},
        {x = 23, y = 37},
        {x = 23, y = 36},
        {x = 24, y = 36},
        {x = 24, y = 35},
        {x = 25, y = 35},
        {x = 26, y = 35},
        {x = 26, y = 34},
        {x = 27, y = 34},
        {x = 28, y = 33},
        {x = 29, y = 33},
        {x = 29, y = 32},
        {x = 30, y = 32},
        {x = 31, y = 32},
        {x = 31, y = 31},
        {x = 32, y = 31},
        {x = 32, y = 30},
        {x = 33, y = 30},
        {x = 34, y = 30},
        {x = 34, y = 29},
        {x = 35, y = 29},
        {x = 36, y = 28},
        {x = 37, y = 28},
        {x = 37, y = 27},
        {x = 38, y = 27},
        {x = 39, y = 27},
        {x = 39, y = 26},
        {x = 40, y = 26},
        {x = 40, y = 25},
        {x = 41, y = 25, isTurn = true},
        {x = 40, y = 24},
        {x = 39, y = 24},
        {x = 39, y = 23},
        {x = 38, y = 23},
        {x = 38, y = 22},
        {x = 37, y = 22},
        {x = 37, y = 21},
        {x = 36, y = 21},
        {x = 36, y = 20},
        {x = 35, y = 20},
        {x = 34, y = 19},
        {x = 33, y = 18},
        {x = 32, y = 18},
        {x = 32, y = 17},
        {x = 31, y = 17},
        {x = 31, y = 16},
        {x = 30, y = 16},
        {x = 30, y = 15},
        {x = 29, y = 15},
        {x = 29, y = 14},
        {x = 28, y = 14},
        {x = 28, y = 13},
        {x = 27, y = 13},
        {x = 26, y = 12},
        {x = 25, y = 12},
        {x = 25, y = 11},
        {x = 24, y = 11},
        {x = 23, y = 11},
        {x = 23, y = 10},
        {x = 22, y = 10},
        {x = 21, y = 10},
        {x = 21, y = 9 },
        {x = 20, y = 9 },
        {x = 19, y = 9 },
        {x = 18, y = 8 },
        {x = 17, y = 8 },
        {x = 16, y = 7 },
        {x = 15, y = 7 },
        {x = 14, y = 6 },
        {x = 13, y = 6 },
        {x = 12, y = 6 },
        {x = 12, y = 5 },
        {x = 11, y = 5 },
        {x = 10, y = 5 },
        {x = 10, y = 4 },
        {x = 9 , y = 4 },
        {x = 8 , y = 4 },
        {x = 8 , y = 3 },
        {x = 7 , y = 3 },
    },

    [CHS[7002265]] = { -- 水云间
        {x = 10, y = 32},
        {x = 10, y = 31},
        {x = 10, y = 30},
        {x = 10, y = 29},
        {x = 9 , y = 29},
        {x = 9 , y = 28},
        {x = 9 , y = 27, isTurn = true},
        {x = 10, y = 26},
        {x = 11, y = 25},
        {x = 12, y = 24},
        {x = 13, y = 23},
        {x = 12, y = 23},
        {x = 12, y = 22},
        {x = 11, y = 21},
        {x = 10, y = 20},
        {x = 10, y = 19},
        {x = 9 , y = 19},
        {x = 9 , y = 18},
        {x = 8 , y = 18},
        {x = 8 , y = 17},
        {x = 7 , y = 17},
        {x = 7 , y = 16},
        {x = 6 , y = 15},
        {x = 6 , y = 14},
        {x = 6 , y = 13},
        {x = 6 , y = 12},
        {x = 6 , y = 11},
        {x = 7 , y = 10},
        {x = 7 , y = 9 },
        {x = 7 , y = 8 },
        {x = 7 , y = 7 },
        {x = 7 , y = 6 , isTurn = true},
        {x = 8 , y = 6 },
        {x = 9 , y = 6 },
        {x = 10, y = 6 },
        {x = 11, y = 6 },
        {x = 12, y = 6 },
        {x = 13, y = 6 },
        {x = 13, y = 7 },
        {x = 14, y = 7 },
        {x = 15, y = 7 },
        {x = 16, y = 7 },
        {x = 17, y = 7 },
        {x = 18, y = 7 },
        {x = 19, y = 7 },
        {x = 20, y = 7 },
        {x = 21, y = 7 },
        {x = 22, y = 7 },
        {x = 23, y = 7 },
        {x = 24, y = 7 },
        {x = 25, y = 7 },
        {x = 26, y = 7 },
        {x = 27, y = 8 },
        {x = 28, y = 8 },
        {x = 29, y = 8 },
        {x = 30, y = 8 },
        {x = 31, y = 8 },
        {x = 32, y = 8 },
        {x = 33, y = 8 },
        {x = 34, y = 8 },
        {x = 34, y = 9 },
        {x = 35, y = 9 },
        {x = 36, y = 9 },
        {x = 37, y = 9 },
        {x = 38, y = 9 },
        {x = 39, y = 9 },
        {x = 39, y = 10},
        {x = 40, y = 10},
        {x = 41, y = 10},
        {x = 42, y = 10},
        {x = 43, y = 10},
        {x = 44, y = 10},
        {x = 45, y = 10},
        {x = 46, y = 10},
        {x = 46, y = 11},
        {x = 47, y = 11},
        {x = 48, y = 11},
        {x = 49, y = 11},
        {x = 50, y = 11},
        {x = 51, y = 11, isTurn = true},
        {x = 52, y = 12},
        {x = 53, y = 12},
        {x = 53, y = 13},
        {x = 54, y = 13},
        {x = 54, y = 14},
        {x = 55, y = 14},
        {x = 55, y = 15},
        {x = 54, y = 15},
        {x = 54, y = 16},
        {x = 54, y = 17},
        {x = 53, y = 18},
        {x = 53, y = 19},
        {x = 52, y = 20},
        {x = 52, y = 21},
        {x = 52, y = 22},
        {x = 51, y = 22},
        {x = 51, y = 23},
        {x = 51, y = 24, isTurn = true},
        {x = 52, y = 24},
        {x = 52, y = 25},
        {x = 52, y = 26},
        {x = 53, y = 26},
        {x = 53, y = 27},
        {x = 53, y = 28},
        {x = 54, y = 29},
        {x = 54, y = 30},
        {x = 54, y = 31},
        {x = 55, y = 31},
        {x = 55, y = 32},
        {x = 55, y = 33},
        {x = 56, y = 33},
        {x = 56, y = 34, isTurn = true},
        {x = 55, y = 34},
        {x = 55, y = 35},
        {x = 54, y = 35},
        {x = 54, y = 36},
        {x = 53, y = 36},
        {x = 52, y = 36},
        {x = 52, y = 37},
        {x = 51, y = 37},
        {x = 51, y = 38},
        {x = 50, y = 38},
        {x = 49, y = 38},
        {x = 49, y = 39},
        {x = 48, y = 39},
        {x = 48, y = 40},
        {x = 47, y = 40},
        {x = 46, y = 40},
        {x = 46, y = 41},
        {x = 45, y = 41},
        {x = 45, y = 42},
        {x = 44, y = 42},
        {x = 44, y = 43},
        {x = 43, y = 43},
        {x = 42, y = 43},
        {x = 41, y = 43},
        {x = 40, y = 43},
        {x = 39, y = 44},
        {x = 38, y = 44},
        {x = 37, y = 44},
        {x = 36, y = 44},
        {x = 35, y = 44},
        {x = 34, y = 44},
        {x = 33, y = 44},
        {x = 32, y = 44},
        {x = 31, y = 45},
        {x = 30, y = 45},
        {x = 29, y = 45},
        {x = 28, y = 45},
        {x = 27, y = 45},
        {x = 26, y = 45},
        {x = 25, y = 46},
        {x = 24, y = 46},
        {x = 23, y = 46, isTurn = true},
        {x = 23, y = 45},
        {x = 22, y = 45},
        {x = 21, y = 45},
        {x = 20, y = 44},
        {x = 19, y = 44},
        {x = 18, y = 44},
        {x = 17, y = 43},
        {x = 16, y = 43},
        {x = 15, y = 42},
        {x = 15, y = 41},
        {x = 14, y = 41},
        {x = 14, y = 40},
        {x = 13, y = 40},
        {x = 13, y = 39},
        {x = 12, y = 39},
        {x = 12, y = 38, isTurn = true},
        {x = 13, y = 38},
        {x = 13, y = 37},
        {x = 14, y = 37},
        {x = 15, y = 36},
        {x = 16, y = 36},
        {x = 16, y = 35},
        {x = 17, y = 35},
        {x = 17, y = 34},
        {x = 18, y = 34},
        {x = 19, y = 34},
        {x = 19, y = 33},
        {x = 20, y = 33},
        {x = 20, y = 32},
        {x = 21, y = 32},
        {x = 22, y = 32},
        {x = 22, y = 31},
        {x = 23, y = 31},
        {x = 23, y = 30},
        {x = 24, y = 30},
        {x = 25, y = 29},
        {x = 26, y = 29},
        {x = 26, y = 28},
        {x = 27, y = 28},
        {x = 27, y = 27},
        {x = 28, y = 27},
        {x = 29, y = 27},
        {x = 29, y = 26},
        {x = 30, y = 26},
        {x = 31, y = 26},
        {x = 31, y = 25, isTurn = true},
        {x = 32, y = 25},
        {x = 33, y = 25},
        {x = 34, y = 25},
        {x = 35, y = 25},
        {x = 36, y = 25},
        {x = 37, y = 25},
        {x = 38, y = 25},
        {x = 39, y = 25},
        {x = 40, y = 25},
        {x = 41, y = 25},
        {x = 42, y = 25},
        {x = 43, y = 25},
        {x = 44, y = 25},
        {x = 45, y = 25},
        {x = 46, y = 25, isTurn = true},
        {x = 46, y = 24},
    },

    [CHS[3001451]] = { -- 蓬莱岛
        {x = 9 , y = 75},
        {x = 10, y = 75},
        {x = 10, y = 74},
        {x = 10, y = 73},
        {x = 10, y = 72},
        {x = 11, y = 72},
        {x = 11, y = 71},
        {x = 11, y = 70},
        {x = 11, y = 69},
        {x = 12, y = 69},
        {x = 12, y = 68},
        {x = 12, y = 67},
        {x = 13, y = 67},
        {x = 13, y = 66},
        {x = 13, y = 65},
        {x = 13, y = 64},
        {x = 14, y = 64},
        {x = 14, y = 63},
        {x = 14, y = 62},
        {x = 15, y = 61},
        {x = 15, y = 60},
        {x = 15, y = 59},
        {x = 16, y = 59},
        {x = 16, y = 58},
        {x = 16, y = 57},
        {x = 16, y = 56},
        {x = 17, y = 56},
        {x = 17, y = 55},
        {x = 17, y = 54},
        {x = 18, y = 54},
        {x = 18, y = 53},
        {x = 18, y = 52},
        {x = 18, y = 51},
        {x = 19, y = 51},
        {x = 19, y = 50},
        {x = 19, y = 49},
        {x = 19, y = 48, isTurn = true},
        {x = 20, y = 48},
        {x = 20, y = 47},
        {x = 20, y = 46},
        {x = 20, y = 45},
        {x = 20, y = 44},
        {x = 20, y = 43},
        {x = 20, y = 42},
        {x = 20, y = 41},
        {x = 20, y = 40},
        {x = 20, y = 39},
        {x = 20, y = 38},
        {x = 20, y = 37},
        {x = 21, y = 36},
        {x = 21, y = 35},
        {x = 21, y = 34},
        {x = 21, y = 33},
        {x = 21, y = 32},
        {x = 21, y = 31},
        {x = 21, y = 30},
        {x = 21, y = 29},
        {x = 21, y = 28},
        {x = 21, y = 27, isTurn = true},
        {x = 20, y = 27},
        {x = 20, y = 26},
        {x = 19, y = 26},
        {x = 18, y = 26},
        {x = 18, y = 25},
        {x = 17, y = 25},
        {x = 16, y = 25},
        {x = 16, y = 24},
        {x = 15, y = 24},
        {x = 14, y = 24},
        {x = 14, y = 23},
        {x = 13, y = 23},
        {x = 12, y = 23},
        {x = 12, y = 22},
        {x = 11, y = 22},
        {x = 10, y = 22},
        {x = 10, y = 21, isTurn = true},
        {x = 9 , y = 21},
        {x = 10, y = 21},
        {x = 11, y = 21},
        {x = 11, y = 20},
        {x = 12, y = 20},
        {x = 13, y = 20},
        {x = 14, y = 20},
        {x = 14, y = 19},
        {x = 15, y = 19},
        {x = 16, y = 19},
        {x = 17, y = 19},
        {x = 17, y = 18},
        {x = 18, y = 18},
        {x = 19, y = 18},
        {x = 20, y = 18},
        {x = 20, y = 17},
        {x = 21, y = 17},
        {x = 22, y = 17},
        {x = 23, y = 17},
        {x = 24, y = 16},
        {x = 25, y = 16},
        {x = 26, y = 16},
        {x = 26, y = 15},
        {x = 27, y = 15},
        {x = 28, y = 15},
        {x = 29, y = 15},
        {x = 30, y = 14},
        {x = 31, y = 14},
        {x = 32, y = 14, isTurn = true},
        {x = 33, y = 13},
        {x = 34, y = 13},
        {x = 35, y = 13},
        {x = 36, y = 13},
        {x = 37, y = 13},
        {x = 38, y = 13},
        {x = 39, y = 13},
        {x = 40, y = 13},
        {x = 41, y = 13},
        {x = 42, y = 13},
        {x = 43, y = 13},
        {x = 44, y = 13},
        {x = 45, y = 13},
        {x = 46, y = 13},
        {x = 47, y = 13},
        {x = 48, y = 13},
        {x = 49, y = 13},
        {x = 50, y = 13},
        {x = 51, y = 13},
        {x = 52, y = 13},
        {x = 53, y = 13},
        {x = 54, y = 13},
        {x = 55, y = 13},
        {x = 56, y = 13},
        {x = 57, y = 13},
        {x = 58, y = 13},
        {x = 59, y = 13},
        {x = 60, y = 13, isTurn = true},
        {x = 60, y = 14},
        {x = 60, y = 15},
        {x = 60, y = 16},
        {x = 60, y = 17},
        {x = 60, y = 18},
        {x = 60, y = 19},
        {x = 60, y = 20},
        {x = 60, y = 21},
        {x = 60, y = 22},
        {x = 60, y = 23},
        {x = 60, y = 24},
        {x = 60, y = 25},
        {x = 60, y = 26},
        {x = 60, y = 27},
        {x = 60, y = 28},
        {x = 60, y = 29},
        {x = 60, y = 30},
        {x = 60, y = 31},
        {x = 60, y = 32},
        {x = 60, y = 33},
        {x = 60, y = 34},
        {x = 60, y = 35},
        {x = 60, y = 36},
        {x = 60, y = 37},
        {x = 60, y = 38},
        {x = 59, y = 38},
        {x = 59, y = 39},
        {x = 59, y = 40},
        {x = 59, y = 41},
        {x = 59, y = 42},
        {x = 59, y = 43},
        {x = 59, y = 44},
        {x = 59, y = 45},
        {x = 59, y = 46},
        {x = 59, y = 47},
        {x = 59, y = 48},
        {x = 59, y = 49},
        {x = 59, y = 50},
        {x = 59, y = 51},
        {x = 59, y = 52},
        {x = 59, y = 53},
        {x = 59, y = 54},
        {x = 59, y = 55},
        {x = 59, y = 56},
        {x = 59, y = 57},
        {x = 59, y = 58},
        {x = 59, y = 59},
        {x = 59, y = 60},
        {x = 59, y = 61},
        {x = 59, y = 62},
        {x = 59, y = 63},
        {x = 59, y = 64},
        {x = 59, y = 65},
        {x = 59, y = 66},
        {x = 59, y = 67},
        {x = 59, y = 68},
        {x = 59, y = 69, isTurn = true},
        {x = 58, y = 70},
        {x = 58, y = 71},
        {x = 57, y = 71},
        {x = 57, y = 72},
        {x = 56, y = 72},
        {x = 56, y = 73},
        {x = 55, y = 73},
        {x = 55, y = 74},
        {x = 54, y = 75},
        {x = 54, y = 76},
        {x = 53, y = 76},
        {x = 53, y = 77},
        {x = 52, y = 77},
        {x = 52, y = 78},
        {x = 51, y = 78},
        {x = 51, y = 79},
        {x = 50, y = 79, isTurn = true},
        {x = 50, y = 78},
        {x = 49, y = 78},
        {x = 48, y = 78},
        {x = 47, y = 78},
        {x = 47, y = 77},
        {x = 46, y = 77},
        {x = 45, y = 77},
        {x = 45, y = 76},
        {x = 44, y = 76},
        {x = 43, y = 76},
        {x = 42, y = 76},
        {x = 42, y = 75},
        {x = 41, y = 75},
        {x = 40, y = 75},
        {x = 39, y = 75},
        {x = 39, y = 74},
        {x = 38, y = 74},
        {x = 37, y = 74},
        {x = 36, y = 74},
        {x = 36, y = 73},
        {x = 35, y = 73},
        {x = 34, y = 73},
        {x = 33, y = 73},
        {x = 33, y = 72},
        {x = 32, y = 72},
        {x = 32, y = 71, isTurn = true},
        {x = 33, y = 70},
        {x = 33, y = 69},
        {x = 33, y = 68},
        {x = 33, y = 67},
        {x = 34, y = 67},
        {x = 34, y = 66},
        {x = 34, y = 65},
        {x = 34, y = 64},
        {x = 34, y = 63},
        {x = 35, y = 63},
        {x = 35, y = 62},
        {x = 35, y = 61},
        {x = 35, y = 60},
        {x = 36, y = 60},
        {x = 36, y = 59},
        {x = 36, y = 58},
        {x = 36, y = 57},
        {x = 36, y = 56},
        {x = 37, y = 56},
        {x = 37, y = 55},
        {x = 37, y = 54},
        {x = 37, y = 53},
        {x = 38, y = 53},
        {x = 38, y = 52},
        {x = 38, y = 51},
    },
}

local TURN_CONFIG = {
    [CHS[3000860]] = { -- 桃柳林
        {x = 54, y = 49, dir = 2},
        {x = 49, y = 33},
        {x = 11, y = 17},
        {x = 7,  y = 3 },
    },

    [CHS[3001303]] = { -- 卧龙坡
       {x = 8,  y = 41, dir = 3},
       {x = 18, y = 30, isTurn = true},
       {x = 45, y = 40, isTurn = true},
       {x = 38, y = 15, isTurn = true},
       {x = 46, y = 10},
    },

    [CHS[3001382]] = { -- 揽仙镇外
        {x = 9 , y = 43, dir = 4},
        {x = 33, y = 43, isTurn = true},
        {x = 44, y = 35, isTurn = true},
        {x = 28, y = 19, isTurn = true},
        {x = 48, y =  3},
    },

    [CHS[4100246]] = { -- 绝仙阵
        {x = 7 , y = 48, dir = 4},
        {x = 47, y = 48, isTurn = true},
        {x = 41, y = 36, isTurn = true},
        {x = 16, y = 18, isTurn = true},
        {x = 29, y = 14, isTurn = true},
        {x = 39, y =  5},
    },

    [CHS[4100247]] = { -- 地绝阵
        {x = 8 , y = 9, dir = 6},
        {x = 7 , y = 46, isTurn = true},
        {x = 37, y = 47, isTurn = true},
        {x = 47, y = 40, isTurn = true},
        {x = 30, y = 24, isTurn = true},
        {x = 48, y = 5 },
    },

    [CHS[4100248]] = { -- 天绝阵
        {x = 52, y = 5 , dir = 6},
        {x = 55, y = 26, isTurn = true},
        {x = 45, y = 48, isTurn = true},
        {x = 5 , y = 48, isTurn = true},
        {x = 9 , y = 34, isTurn = true},
        {x = 24, y = 34, isTurn = true},
        {x = 30, y = 26, isTurn = true},
        {x = 30, y = 6 },
    },

    [CHS[4100244]] = { -- 东昆仑
        {x = 22, y = 84, dir = 3},
        {x = 48, y = 65, isTurn = true},
        {x = 14, y = 42, isTurn = true},
        {x = 41, y = 25, isTurn = true},
        {x = 7 , y = 3 },
    },

    [CHS[7002265]] = { -- 水云间
        {x = 10, y = 32, dir = 2},
        {x = 9 , y = 27, isTurn = true},
        {x = 7 , y = 6 , isTurn = true},
        {x = 51, y = 11, isTurn = true},
        {x = 51, y = 24, isTurn = true},
        {x = 56, y = 34, isTurn = true},
        {x = 23, y = 46, isTurn = true},
        {x = 12, y = 38, isTurn = true},
        {x = 31, y = 25, isTurn = true},
        {x = 46, y = 25, isTurn = true},
        {x = 46, y = 24},
    },

    [CHS[3001451]] = { -- 蓬莱岛
        {x = 9 , y = 75, dir = 3},
        {x = 19, y = 48, isTurn = true},
        {x = 21, y = 27, isTurn = true},
        {x = 10, y = 21, isTurn = true},
        {x = 32, y = 14, isTurn = true},
        {x = 60, y = 13, isTurn = true},
        {x = 59, y = 69, isTurn = true},
        {x = 50, y = 79, isTurn = true},
        {x = 32, y = 71, isTurn = true},
        {x = 38, y = 51},
    },
}

local YAOMO_ICON = {
    06226, 06227, 06228, 06229
}

local YAOMO_GAME_STATUS = {
    WAIT = 1,
    START = 2,
    STOP = 3
}

local SHAKE_TYPE = {
    CLICK = 1,  -- 点击
    VOICE = 2,  -- 发声
}

local ATTACK_YM_DIS = 13 * Const.PANE_HEIGHT -- 玩家攻击妖魔的距离
local ATTACK_ME_DIS = 3 * Const.PANE_HEIGHT  -- 妖魔可攻击玩家的距离

local posCfg

function LingyzmMgr:isClickShakeType(type)
    if type == SHAKE_TYPE.CLICK then
        return true
    end
end

function LingyzmMgr:clearData()
    self:clearAllChar()
    DlgMgr:closeDlg("LingyzmDlg")

    self.ymIcon = nil
end

function LingyzmMgr:clearAllChar()
    for k, v in pairs(self.yaomoChars) do
        if k and v then
            v:cleanup()
        end
    end

    self.yaomoChars = {}
end

function LingyzmMgr:update()
    if self.ymGameStatus ~= YAOMO_GAME_STATUS.START then
        return
    end

    -- 增加黑幕背景
    FightMgr:updateFightBg()

    if Me:isStandAction() then
        local mx, my = gf:convertToMapSpace(Me.curX, Me.curY)
        if self.destPos[self.walkIndex] and math.abs(self.destPos[self.walkIndex].x - mx) >= 2 and math.abs(self.destPos[self.walkIndex].y - my) >= 2 then
            -- 异常情况
            Me:setEndPos(self.destPos[self.walkIndex].x, self.destPos[self.walkIndex].y)
        elseif self.destPos[self.walkIndex + 1] then
            --
            self.walkIndex = self.walkIndex + 1
            Me:setEndPos(self.destPos[self.walkIndex].x, self.destPos[self.walkIndex].y)
        else
            -- 走到终点
            self.ymGameStatus = YAOMO_GAME_STATUS.STOP

            DlgMgr:sendMsg("LingyzmDlg", "showResult", "succ")
            return
        end
    end

    local char = self.yaomoChars[self.curYMIndex]
    local canShowLife = true
    if char then
        local curTime = gfGetTickCount()
        local startTime = self.shakeTime[char.shakeType] or 0

        -- 检测是否处于妖魔可攻击范围
        local dis = gf:distance(char.curX, char.curY, Me.curX, Me.curY)
        if dis < ATTACK_ME_DIS then
            -- 被打死
            self.ymGameStatus = YAOMO_GAME_STATUS.STOP

            -- 先站立清除步数
            Me:setAct(Const.FA_STAND)

            -- 死亡
            Me:setActAndCB(Const.FA_DIE_NOW, function()
                if Me.faAct == Const.FA_DIE_NOW then
                    Me:setActAndCB(Const.FA_DIED)
                end
            end)

            DlgMgr:sendMsg("LingyzmDlg", "setGameOver")
            performWithDelay(gf:getUILayer(), function()
                DlgMgr:sendMsg("LingyzmDlg", "showResult", "fail")
            end, 1)

            if char.isSleep then
                -- 恢复攻击状态
                char:playAction()
            end

            return
        end

        if dis > ATTACK_YM_DIS then
            -- 距离怪物 13 格内才开始显示血量并扣血
            canShowLife = false
            if startTime > 0 then
                self.shakeTime[char.shakeType] = curTime
                startTime = curTime
            end
        end

        -- 检测扣妖魔血
        if startTime > 0 and curTime - startTime > 0 then
            if not char.isSleep then
                -- 昏睡
                char:playSleep()
            end

            local addTime = curTime - startTime
            local life = char:queryBasicInt("life")
            if self.gameIndex then
                life = life - ((addTime / 1000) / self.totalTime) * 100 * 1.3 * (1.7 - 0.05 * self.gameIndex)
            else
                life = life - ((addTime / 1000) / self.totalTime) * 100 * 1.3
            end

            char:setBasic("life", life)
            self.shakeTime[char.shakeType] = self.shakeTime[char.shakeType] + curTime - startTime
            if life <= 0 then
                -- 妖魔死亡
                char:playDie()

                canShowLife = false
                self:setNextAttackYM()
            end
        else
            if char.isSleep then
                -- 恢复攻击状态
                char:playAction()
            end
        end
    end

    for i = 1, #self.yaomoChars do
        self.yaomoChars[i]:setShowLife(self.curYMIndex == i, canShowLife)
        self.yaomoChars[i]:update()
    end
end

function LingyzmMgr:setShakeTime(type, time)
    if not self.shakeTime then self.shakeTime = {} end

    self.shakeTime[type] = time
end

function LingyzmMgr:getShakeTime(type)
    return self.shakeTime and self.shakeTime[type] or 0
end

-- 获取当前妖魔需要的震动类型
function LingyzmMgr:getCurYmShakeType()
    return self.yaomoChars[self.curYMIndex] and self.yaomoChars[self.curYMIndex].showLife and self.yaomoChars[self.curYMIndex].shakeType
end

-- 设置下一只要攻击的妖魔
function LingyzmMgr:setNextAttackYM()
    self.curYMIndex = self.curYMIndex + 1

    local nextChar = self.yaomoChars[self.curYMIndex]
    if not nextChar then
        return
    end

    -- 根据与妖魔的初始距离计算打死妖魔要震动的铃铛的时间
    local nextDis = gf:distance(nextChar.curX, nextChar.curY, Me.curX, Me.curY) - ATTACK_ME_DIS
    if nextDis < (ATTACK_YM_DIS - ATTACK_ME_DIS) then
        self.totalTime = 1.2 * (nextDis / (ATTACK_YM_DIS - ATTACK_ME_DIS))
    else
        self.totalTime = 1.2
    end
end

function LingyzmMgr:curIsClickShakeType()
    local char = self.yaomoChars[self.curYMIndex]
    if char and char.shakeType == SHAKE_TYPE.CLICK then
        return true
    end
end

-- 人物开始行走
function LingyzmMgr:setPlayerRun()
    if not self.destPos then
        return
    end

    self.ymGameStatus = YAOMO_GAME_STATUS.START
    self.shakeTime = {}
    self.curYMIndex = 0
    self.walkIndex = 1
    self.totalTime = 1.2
    if self.destPos and self.destPos[self.walkIndex] then
        Me:setEndPos(self.destPos[self.walkIndex].x, self.destPos[self.walkIndex].y)
    end

    if self.ymGameSch then
        gf:getUILayer():stopAction(self.ymGameSch)
    end

    self.ymGameSch = schedule(gf:getUILayer(), function()
        self:update()
    end, 0)

    self:setNextAttackYM()
end

-- 创建学习时的妖魔
function LingyzmMgr:initStudyChar(type)
    self:clearAllChar()

    self.ymIcon = YAOMO_ICON[math.random(1, 4)]

    self.destPos = {
        {x = 126, y = 85},
    }

    Me:setDir(5)

    self:creatChar(126, 85, 1, type)
end

function LingyzmMgr:initLyzmGame()
    self:clearAllChar()

    local mapName = MapMgr:getCurrentMapName()
    posCfg = POS_CONFIG[mapName]

    -- 角色跑动路径
    self.destPos = TURN_CONFIG[mapName]

    if not posCfg or not self.destPos then
        return
    end

    self.curYMNum = 0
    self.allYMIsSleep = false

    -- 随机妖魔形象
    if not self.ymIcon or self.lastMapName ~= mapName then
        self.ymIcon = YAOMO_ICON[math.random(1, 4)]
    end

    -- 创建妖魔对象
    for i = 1, 50 do
        if not self:createRealChar() then
            break
        end
    end

    self.lastMapName = mapName

    local toX, toY = gf:convertToClientSpace(self.destPos[2].x, self.destPos[2].y)
    local dir = gf:defineDir(cc.p(Me.curX, Me.curY), cc.p(toX, toY), Me:getIcon())
    Me:setDir(dir)

    self.ymGameStatus = YAOMO_GAME_STATUS.WAIT
end

-- 创建妖魔
function LingyzmMgr:createRealChar()
    local index = self.curYMNum * 10 + 16
    if not posCfg or not posCfg[index + 10] then
        -- 后 10 个点不显示妖魔
        return
    end

    local pos = posCfg[index]
    local x = pos.x
    local y = pos.y
    local lastChar = self.yaomoChars[self.curYMNum] or Me

    local dir = gf:defineDirForPet(cc.p(gf:convertToClientSpace(x, y)), cc.p(lastChar.curX, lastChar.curY))

    local char = self:creatChar(x, y, dir, math.random(1, 2))
    self.curYMNum = self.curYMNum + 1
    return true
end

-- 所有妖魔播放昏睡状态
function LingyzmMgr:setYMSleep()
    if self.allYMIsSleep then
        return
    end

    self.allYMIsSleep = true
    for i = 1, #self.yaomoChars do
        self.yaomoChars[i]:playSleep()
    end
end

-- 所有妖魔播放攻击状态
function LingyzmMgr:setYMAttack()
    if not self.allYMIsSleep then
        return
    end

    self.allYMIsSleep = false
    for i = 1, #self.yaomoChars do
        self.yaomoChars[i]:playAction()
    end
end

function LingyzmMgr:creatChar(x, y, dir, type)
    local char = require("obj/activityObj/LyzmNpc").new()

    char:absorbBasicFields({
        icon = self.ymIcon,
        dir = dir,
        max_life = 100,
        life = 100,
    })

    char:onEnterScene(x, y)

    char:setAct(Const.FA_STAND)

    char.shakeType = type

    table.insert(self.yaomoChars, char)

    char:playAction()

    return char
end

function LingyzmMgr:setLingyzmGameOver()
    self:clearAllChar()

    if self.ymGameSch then
        gf:getUILayer():stopAction(self.ymGameSch)
        self.ymGameSch = nil
    end

    self.ymGameStatus = YAOMO_GAME_STATUS.STOP
end

function LingyzmMgr:onEndRecord(data)
    local function callback(retult)
        if self.endRecordCb then
            self.isRecording = retult
            self.endRecordCb(retult)
        end
    end

    if not GameMgr:isYayaImEnabled() then
        callback(false)
        return
    end

    if data.para == "volume" then
        -- 音量大小
        local volume = data.result
        DlgMgr:sendMsg("LingyzmDlg", "onVolumeChange", tonumber(volume))
    end

    if data.errCode ~= 0 then
        if data.errCode == 1911 then
            gf:gotoSetting("Record")
        else
            gf:ShowSmallTips(CHS[3003950] .. tostring(result))
        end

        self:cancelRecord()
        callback(false)
    else
        callback(true)
    end

    self.endRecordCb = nil
end


function LingyzmMgr:checkCanOpenRecord(callback, notTip)
    if ATM_IS_DEBUG_VER and gf:isWindows() then
        callback(true)
        return true
    end

    if not GameMgr:isYayaImEnabled() then
        if not notTip then
            gf:ShowSmallTips(CHS[3004450])
        end

        callback(false)
        return false
    end

    if self.isRecording then
        callback(true)
        return true
    end

    if ChatMgr.curRecordMediaFile then
        gf:ShowSmallTips(CHS[3003948])
        callback(false)
        return false
    end

    self.endRecordCb = nil
    
    if not gf:checkPermission("Record", "LingyzmMgr:checkCanOpenRecord", nil, function() gf:gotoSetting("Record") end) then return false end

    local result = YayaImMgr:startRecord(ChatMgr:getMediaSaveFile(), "LingyzmMgr:onEndRecord", 0)

    if result ~= 0 then
        ChatMgr:clearRecord()
        if not notTip then
            if result == 1911 then
                gf:gotoSetting("Record")
            else
                gf:ShowSmallTips(CHS[3003950] .. tostring(result))
            end
        end

        callback(false)
        return false
    else
        self.endRecordCb = callback
        return true
    end
end

function LingyzmMgr:cancelRecord()
    self.isRecording = false
    ChatMgr:clearRecord()
    ChatMgr:stopRecord()
end

-- 通知镇魔游戏结果
function LingyzmMgr:cmdLYZMGameResult(result, id)
    result = gfEncrypt(result, id)
    gf:CmdToServer("CMD_HALLOWMAX_2018_LYZM_GAME_RESULT",{result = result})
end

-- 通知镇魔学习结果
function LingyzmMgr:cmdLYZMStudyResult(result, id)
    result = gfEncrypt(result, id)
    gf:CmdToServer("CMD_HALLOWMAX_2018_LYZM_STUDY_RESULT",{result = result})
end

-- 2018万圣节开始学习
function LingyzmMgr:MSG_HALLOWMAX_2018_LYZM_STUDY(data)
    local isFail = false
    if data.status == "2" then
        self:checkCanOpenRecord(function(result)
            if result then
                local dlg = DlgMgr:openDlg("LingyzmDlg")
                dlg:setData(data)
            else
                LingyzmMgr:cmdLYZMStudyResult("fail", data.gameId)
            end
        end)
    else
        local dlg = DlgMgr:openDlg("LingyzmDlg")
        dlg:setData(data)
    end

    self.gameIndex = nil
end

-- 2018万圣节停止学习
function LingyzmMgr:MSG_HALLOWMAX_2018_LYZM_STUDY_STOP(data)
    DlgMgr:closeDlg("LingyzmDlg")
end

-- 2018万圣节进入游戏界面
function LingyzmMgr:MSG_HALLOWMAX_2018_LYZM_GAME_ENTER(data)
    local dlg = DlgMgr:openDlg("LingyzmDlg")
    dlg:setData(data)
end

-- 2018万圣节开始游戏
function LingyzmMgr:MSG_HALLOWMAX_2018_LYZM_GAME(data)
    local dlg = DlgMgr:openDlg("LingyzmDlg")

    data.isRunning = true
    self.gameIndex = data.game_index -- 第几关
    dlg:setData(data)
end

-- 2018万圣节停止游戏
function LingyzmMgr:MSG_HALLOWMAX_2018_LYZM_GAME_STOP(data)
    DlgMgr:closeDlg("LingyzmDlg")
end

MessageMgr:regist("MSG_HALLOWMAX_2018_LYZM_GAME_ENTER", LingyzmMgr)
MessageMgr:regist("MSG_HALLOWMAX_2018_LYZM_STUDY", LingyzmMgr)
MessageMgr:regist("MSG_HALLOWMAX_2018_LYZM_STUDY_STOP", LingyzmMgr)
MessageMgr:regist("MSG_HALLOWMAX_2018_LYZM_GAME", LingyzmMgr)
MessageMgr:regist("MSG_HALLOWMAX_2018_LYZM_GAME_STOP", LingyzmMgr)